#!/usr/bin/python3
import requests
import re
import argparse

def fetch_and_parse_xml(url):
    try:
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'
        }
        # Fetching the XML content from the URL
        response = requests.get(url+'feed/', headers=headers)
        response.raise_for_status()
        #print(response.text)

        # Parsing the XML content to extract the version
        version = re.search(r'wordpress.org/\?v=([\d\.]+)', response.text)
        if version:
            return version.group(1)
        else:
            return "Version not found in the XML content."

    except requests.RequestException as e:
        return f"Error fetching the XML: {e}"

if __name__ == "__main__":
    # Creating a parser for command-line arguments
    parser = argparse.ArgumentParser(description='Fetch and parse XML from a given URL.')
    parser.add_argument('url', type=str, help='The URL of the XML feed')
    
    # Parsing the arguments
    args = parser.parse_args()

    # Fetching and parsing the XML
    version = fetch_and_parse_xml(args.url)
    print(version)
