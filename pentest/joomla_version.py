#!/usr/bin/python3
import argparse
import requests
from urllib.parse import urljoin
import re
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def get_joomla_version(base_url):
    paths = [
        "administrator/manifests/files/joomla.xml",
        "language/en-GB/en-GB.xml"
    ]
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko",
        "Accept-Language": "en-US,en;q=0.5",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
        "Connection": "keep-alive",
        "Accept-Encoding": "gzip, deflate",
    }

    for path in paths:
        full_url = urljoin(base_url, path)
        try:
            response = requests.get(full_url, headers=headers, timeout=5, verify=False)
            if response.status_code == 200:
                match = re.search(r"<version>([^<]+)<", response.text)
                if match:
                    return match.group(1)
        except requests.RequestException:
            continue

    return None

def main():
    parser = argparse.ArgumentParser(description="Detect Joomla version")
    parser.add_argument("--url", required=True, help="Base URL of Joomla site (e.g., http://example.com/)")
    args = parser.parse_args()

    version = get_joomla_version(args.url)
    if version:
        print(f"Joomla Core version: {version}")
    else:
        print("No Joomla version detected.")

if __name__ == "__main__":
    main()
